"0","x_start <- dataset$start.station.latitude"
"0","y_start <- dataset$start.station.longitude"
"0","x_stop  <- dataset$end.station.latitude"
"0","y_stop  <- dataset$end.station.longitude"
"0",""
"0","distances <- double(length(x_start))"
"0",""
"0","# distHaversine() returns values in meters, so I divide by 1000 in order to have them in kilometers"
"0",""
"0","for (i in 1:length(x_start)) {"
"0","  distances[i] <- distHaversine(c(x_start[i], y_start[i]), c(x_stop[i], y_stop[i])) / 1000.00"
"0","}"
"0",""
"0","time_in_hour <- dataset$tripduration / 60.00 / 60.00   # Converting in hours"
"0",""
"0","average_speed <- distances / time_in_hour"
"0","average_speed <- average_speed[time_in_hour < 1]   # Discarding trips longer than 1 hour"
"0",""
"0","# Printing the average speed of the first 100 users of the dataset just as an example"
"0",""
"0","print(""Average speed of 100 users (km/h):"")"
"1","[1]"
"1"," ""Average speed of 100 users (km/h):"""
"1","
"
"0","head(average_speed, 100)"
"1","  [1]"
"1","  3.1980276"
"1","  7.6101767"
"1","  2.2136514"
"1"," 14.0018556"
"1"," 12.1392182"
"1","  8.7723673"
"1","  2.3927168"
"1","  8.0168345"
"1","  9.8599869"
"1","  7.2215719"
"1","  9.9421328"
"1","  9.0033128"
"1","
"
"1"," [13]"
"1","  8.2637817"
"1","  8.5696865"
"1","  8.4799551"
"1","  2.8147581"
"1","  9.2470901"
"1","  7.3795981"
"1","  7.3023385"
"1","  4.1283630"
"1","  9.4696992"
"1","  5.7483535"
"1","  1.7340001"
"1","  8.3193288"
"1","
"
"1"," [25]"
"1","  8.0907783"
"1","  6.5482997"
"1"," 13.3666289"
"1","  2.3354326"
"1"," 11.7359170"
"1"," 12.3998694"
"1"," 10.5085533"
"1","  1.7174795"
"1","  1.7030469"
"1","  0.9520334"
"1"," 11.4357786"
"1","  2.9330881"
"1","
"
"1"," [37]"
"1","  2.6364837"
"1"," 20.1231395"
"1"," 13.0098434"
"1"," 13.4064849"
"1","  0.0000000"
"1"," 13.9984493"
"1"," 15.3448779"
"1","  7.7382990"
"1","  5.1206522"
"1","  9.3150277"
"1","  7.0446480"
"1"," 11.0665662"
"1","
"
"1"," [49]"
"1","  6.6409852"
"1","  7.5184210"
"1","  2.0765225"
"1","  7.9551758"
"1","  6.8899140"
"1","  4.3665377"
"1","  3.4854859"
"1","  6.8386734"
"1"," 19.3441031"
"1","  7.4599119"
"1","  2.9139478"
"1","  5.7921370"
"1","
"
"1"," [61]"
"1","  9.6482130"
"1","  9.5297136"
"1","  9.4443220"
"1"," 11.7833189"
"1","  7.8259024"
"1","  3.4186732"
"1","  2.5227707"
"1"," 15.2114632"
"1","  4.5920334"
"1"," 11.7011256"
"1","  9.0212288"
"1"," 12.8322268"
"1","
"
"1"," [73]"
"1","  8.2954565"
"1","  3.2819787"
"1","  9.5879627"
"1","  3.8349365"
"1","  4.9666379"
"1","  5.6533034"
"1","  5.0475923"
"1","  3.0082955"
"1"," 17.0271989"
"1","  7.7382990"
"1","  7.0300479"
"1"," 15.1357843"
"1","
"
"1"," [85]"
"1"," 17.4486820"
"1","  7.6637375"
"1","  2.3232381"
"1"," 11.8822702"
"1"," 13.1286622"
"1","  6.7301231"
"1","  8.0664620"
"1"," 13.7390980"
"1"," 10.3245305"
"1","  9.0844970"
"1","  7.2685329"
"1"," 13.3148844"
"1","
"
"1"," [97]"
"1","  5.7556256"
"1","  9.0398434"
"1","  3.5203095"
"1"," 15.9897733"
"1","
"
